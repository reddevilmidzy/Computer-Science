# OSI 7 계층

##  OSI 7계층이란?
OSI란 Open System Interconnection의 약어로 국제 표준화 기구 ISO가 제안한 네트워크 통신의 표준안이다.
7계층으로 나눈 이유는 네트워크 통신 도중 발생할 수 있는 문제들을 각각의 레벨 안에서 처리하기 위해서이다.

<br>

![osi-7-layers](osi-7-layers.png)

---

## 1계층 - 물리 계층 (Physical Layer)

> * 리피터, 케이블, 허브  
> * 데이터 단위 : 비트 (bit)

물리계층에서는 말그대로 통신의 물리적인 것을 담당한다.
유선 LAN 기술을 표준화한 **IEEE802.3**과 무선 LAN 기술을 표준화 한 **IEEE802.11**로 나눌 수 있다.
IEEE802.3의 프로토콜 이름은 `[전송속도] BASE - [전송 매체나 레이저의 종류]` 의 형태로 지어진다.  
ex) 10GBASE-T (LAN 케이블[트위스트 페어 케이블]로 10Gbps의 전송 속도를 구현하는 프로토콜)  

**전송 속도**

| 표기   | 전송 속도     |
|------|-----------|
| 100  | 100Mbps   |
| 1000 | 1Gbps     |
| 10G  | 10Gbps    |
| 25G  | 25Gbps    |
| 40G  | 40Gbps    |
| 100G | 100Gbps   |

**전송 매체나 레이저의 종류**

| 표기  | 의미          |
|-----|-------------|
| T   | 트위트스 페어 케이블 |
| S   | 단파장 레이저     |
| L   | 장파장 레이저     |
| C   | 동축 케이블      |

### 트위스트 페어 케이블 
트위스트 페어 케이블은 컽으로 보기에는 하나의 케이블이지만, 사실 8가닥의 구리선을 두가닥씩 짝지어(pair) 꼬아서(twisted) 하나로 묶은 케이블이다.
실드 유무에 따라 **UTP**(Unshielded Twisted Pair)와 **STP**(Shielded Twisted Pair) 케이블로 분류할 수 있다.  
서로 꼬아져 있는 이유는 다른 전자기적 간섭을 최소화하기 위해서이다.

### 광섬유 케이블
광섬유 케이블은 거리를 늘려도 신호가 쉽게 감쇠하지 않기에 광대역을 유지할 수 있다. 
빛의 굴절률이 높은 **코어**(core)와, 굴절률이 비교적 낮은 **클래딩**(cladding)의 2층으로 구성되어 있고, 이 빛의 전송로를 모드(mode)라고 부른다.  
모드가 여럿 있다면 *다중 모드 광섬유 케이블*(MMF)이고 코어 지름이 작고 클래딩 비중이 커서 코어를 흐르는 모드가 하나라면 *단일 모드 광섬유 케이블*(SMF)이다.  

| 비교 항목      | 트위스트 페어 케이블 | 광섬유 케이블 |
|------------|-------------|---------|
| 전송 매체 재료   | 구리          | 유리      |
| 전송 속도      | 느림          | 빠름      |
| 신호 감쇄      | 큼           | 적음      |
| 전송 거리      | 짧음          | 김       |
| 전자석 노이즈 경향 | 큼           | 없음      | 
| 반환         | 쉬움          | 어려움     | <!-무엇을 반환하는거지?>
| 비용         | 적음          | 많음      |


<!ToDo: 무선 LAN, CSMA/CD, 주파수 대역>

<br>

---

## 2계층 - 데이터링크 계층 (Datalink Layer)

> * 브릿지, 스위치
> * 데이터 단위 : 프레임 (frame)

데이터링크 계층은 같은 네트워크에 있는 단말을 식별하고, 물리 계층 위에서 비트열을 정확히 전송하는 구조를 제공한다.  
에러검출, 재전송, 흐름 제어의 역활을 수행한다.
데이터링크 계층에서 통신하려면 수신지와 송신지의 **MAC**주소가 필요하다.  

### MAC 주소
MAC 주소는 이더넷 네트워크에 접속되어 있는 단말의 식별 ID이다. 6바이트(48bit)로 구성되며, 16진수로 표기한다.  
`00-0c-29-43-5e-be` 혹은 `04:0c:ce:da:3a:6c`  
MAC 주소의 상위 3바이트는 IEEE가 벤더별로 할당한 벤더 코드로 
**OUI**(Organizationally Unique Identifier)라 
부르고, 통신하는 단말의 NIC를 어떤 벤더가 제조했는지 [사이트](http://standards-oui.ieee.org/oui/oui.txt)에서 확인할 수 있다.  
하위 3바이트는 **UAA**(Universal Administered Address)라 부르고 출하 시 벤더에서 할당하거나 무작위로 생성한 값이다.  

### 통신
이더넷 네트워크에서 통신은 3가지로 구분된다.

#### 유니캐스트(unicast)
유니캐스트는 1대 1통신이다. 때문에 서로의 MAC주소를 갖고 송신지 MAC주소, 수신지 MAC주소를 만든다. 웹이나 메일 등 인터넷 통신의 대부분은 유니캐스트이다.  
<br>

#### 브로드캐스트(broadcast)
브로드캐스트는 1대 n통신이다. 여기에서의 n은 같은 이더넷 네트워크에 접속되어 있는 자신 외의 모든 단말을 의미한다. 
A단말이 브로드캐스트 송신을 하면 그 이더넷 네트워크에 있는 A이외의 모든 단말이 그 프레임을 수신한다. 이때 송신지 MAC주소는 A단말의 MAC주소이고, 
수신지 MAC주소는 어느 하나 특정할 수 없기 때문에 6바이트가 모두 1인 값, 즉 `ff:ff:ff:ff:ff:ff`를 사용한다.  

<br>

#### 멀티캐스트(multicast)
멀티캐스트는 1대 n통신이다. 여기에서의 n은 특정 그룹에 속하는 단말이다. A단말이 멀티캐스트 송신을 하면 그 그룹에 있는 단말들만 그 패킷을 수신한다.  
~~트위터의 써클이나 인스타그램의 친한 친구와 같은 기능이라고 할 수 있다. 트위터 써클은 최근에 결함이 있는것 같지만~~  
송신지의 MAC 주소는 송신 단말의 MAC 주소가 그대로 사용되고, 수신지 MAC 주소는 네트워크 계층에서 받아온 IP를 이용한다.

### L2 스위치
L2 스위치는 이더넷 헤더에 포함된 송신지 MAC 주소와 자신의 포트 번호를 MAC 주소 테이블이라는 메모리상의 테이블로 관리하면서,
이더넷프레임의 전송 대상지를 바꾸어 통신 효율을 높인다.

<br>

---

## 3계층 - 네트워크 계층 (Network Layer)

> * 라우터, IP
> * 데이터 단위: 패킷 (packet)  


네트워크 계층에서는 라우터를 사용하여 경로 설정(라우팅) 역활을 한다.  
**IP**주소를 사용하고, 데이터 단위는 패킷이다.  

### IP
IP는 Internet Protocol의 약어로 통신에 사용하는 주소이다.  
IP에는 IPv4와 IPv6라는 두가지 버전이 존재한다. 인터넷 사용자가 늘어나면서 IPv4의 체계로는 전부 할당할 수
없었기에 등장한 것이 IPv6이다.

#### IPv4
IPv4는 4바이트(32비트)로 구성되어 있으며 8비트씩 점(.) 으로 구분하여 10진수로 표기한다. 그리고 다섯개의 클래스와 서브넷 마스킹을 사용한다.  
다음은 헤더 필드의 포함된 정보들이다.  
ex) `192.168.1.1`, `128.0.0.1`

- 버전 (4비트)  
버전필드에는 IPv4의 버전인 0100(2) 가 들어가게 된다.  

* 헤더 길이 (4비트)  
IPv4의 헤더 길이를 나타내는 필드이고, Internet Header Length의 약자로 `IHL`이라고 부르기도 한다.  


* ToS (8비트)  
ToS는 `Type of Service`의 약어로, 전송되어 오는 IPv4 패킷의 우선도를 확인할 수 있다. 우선 제어나 대역 제어,
혼잡 제어 등 `QoS`(Quality of Service)에서 사용한다.  

 
* 패킷 길이 (16비트)  
패킷 길이는 IPv4 헤더와 IPv4 페이로드를 합친 패킷 전체의 길이를 나타내는 필드이다. 
여기서 페이로드란 실제 전하고자 하는 데이터가 담긴 부분을 말한다.  


* 식별자 (16비트)  
패킷 교환 방식 통신에서는 데이터를 패킷 단위로 쪼개서 보내는데, 이 처리를 **IP 프래그멘테이션**(IP fragmentation)이라고 부른다.  
이 IP 프래그멘테이션에 관한 정보를 식별자와 플래그 그리고 프래그먼트 오프 셋이 담고 있다.
쪼갯 데이터를 나중에 다시 합치기 위한 식별자가 담겨있다.  
  

* 플래그 (3비트)  
1번째 비트: 사용하지 않음  
2번째 비트: **DF**(Don't Fragment) 0이면 프래그멘테이션 허가, 1이면 불허  
3번째 비트: **MF**(More Fragment) 0이면 프래그멘테이션된 패킷이 계속되지 않음, 1이면 패킷에 계속됨   



* 프래그먼트 오프셋 (13비트)  
프래그멘테이션 한 뒤 그 패킷이 오리지널 패킷의 앞쪽부터 어느 위치에 있는지를 나타내는 필드이다.  
시작 인덱스는 0이다.  


* TTL (8비트)  
**TTL**(Time To Live)은 패킷의 수명을 나타내는 필드이다. IP에서의 패킷 수명은 `경유하는 라우터의 수`를 의미한다.  
경우하는 라우터의 수를 홉(hop) 수라고 부른다. 네트워크를 경유할 때 1씩 줄어들고, TTL 값이 0이 되면 그 페킷은 파기되고, 
패킷을 파기한 라우터는 **Time-to-live exceed**라는 메시지를 `ICMP`에 반환하고, 패킷을 파기한 것을 송신지 단말에 전달한다.  


* 프로토콜 번호 (8비트)  
IPv4 페이로드가 어떤 프로토콜로 구성되어 있는지를 나타내는 필드이다.

| 프로토콜 | 번호                                                |
|------|---------------------------------------------------|
| 1    | ICMP(Internet Control Message Protocol)           |
| 2    | IGMP(Internet Group Management Protocol)          |
| 6    | TCP(Transmission Control Protocol)                |
| 17   | UDP(User Datagram Protocol)                       |
| 47   | GRE(Generic Routing Encapsulation)                |
| 50   | ESP(Encapsulating Security Payload)               |
| 88   | EIGRP(Enhanced Interior Gateway Routing Protocol) |
| 89   | OSPF(Open Shortest Path First)                    |
| 112  | VRRP(Virtual Roughter Redundancy Protocol)        |

* 헤더 체크섬 (16비트)  
IPv4의 정합성을 체크하기 위한 필드로 1의 보수 연산을 사용한다.  

* 송수신지 IPv4 주소(각각 32비트)
여기까지가 이제 IPv4의 헤더 정보이고, 송신지, 수신지의 IPv4의 주소가 담긴다.  

### 서브넷 마스크 (subnet mask)
IPv4 주소는 **네트워크 부분**과 **호스트 부분** 2개로 나눠져 있다. 네트워크 부분은 속한 네트워크를 나타내고
호스트 부분은 그 속한 네트워크 중에서 자신의 단말을 나타낸다. 서브넷 마스크는 이 2개를 구분해주며, 네트워크 부분은 1로, 
호스트 부분은 0으로 표현한다.  

IPv4 주소  
192.168.100.1  

서브넷 마스크  
255.255.255.0  

서브넷 마스크가 다음과 같이 있으면 총 24비트가 1로 채워진 것이다. 그러면 IP주소에서 192.168.100 까지가 네트워크 부분인 것이고,
나머지 1 이 호스트 부분인 것이다.  


| 주소 클래스 | 용도         | 시작 비트 | 시작 IP 주소  | 종료 IP 주소        | 네트워크 부분 | 호스트 부분 |
|--------|------------|-------|-----------|-----------------|---------|--------|
| 클래스 A  | 유니캐스트(대규모) | 0     | 0.0.0.0   | 127.255.255.255 | 8비트     | 24비트   |
| 클래스 B  | 유니캐스트(중규모) | 10    | 128.0.0.0 | 191.255.255.255 | 16비트    | 16비트   |
| 클래스 C  | 유니캐스트(소규모) | 110   | 192.0.0.0 | 223.255.255.255 | 24비트    | 8비트    |
| 클래스 D  | 멀티캐스트      | 1110  | 224.0.0.0 | 239.255.255.255 | -       | -      |
| 클래스 E  | 연구, 예약용    | 1111  | 240.0.0.0 | 255.255.255.255 | -       | -      |