# ARP

**ARP**(Address Resolution Protocol)은 물리 주소인 **MAC**주소를 논리 주소인 **IP**주소로 변경시켜주는 프로토콜이다. 
ARP에서 수신지 IPv4 주소로부터 수신지 MAC 주소를 구하는데, 이것을 **주소 결정**이라고 부른다. IPv6 주소의 주소 결정은 ARP가 아닌
ICMPv6에서 수행한다.

## ARP의 프레임 포멧

![ARP 프레임 포멧](arp-format.png)

* 하드웨어 타입
* 프로토콜 타입
* 하드웨어 주소 크기
* 프로토콜 주소 크기
* 오퍼레이션 코드
* 송신지 MAC 주소/송신지 IPv4 주소
* 목표 MAC 주소/목표 IPv4 주소

**오퍼레이션 코드**  

| 오퍼레이션 코드 | 내용                          |
|----------|-----------------------------|
| 1        | ARP Request                 |
| 2        | ARP Reply                   | 
| 3        | Request Reverse (RARP에서 사용) |
| 4        | Reply Reverse (RARP에서 사용)   |


## ARP에 의한 주소 결정 흐름

* ### ARP Request
* * 이전에 통신한 적이 없는 LAN의 라우터로부터 데이터 패킷이 전달되어 목적지 호스트를 찾을 때
* * 라우터는 ARP 요청 패킷을 LAN 전체 노드에 전송한다. `브로드캐스트`
* * 이때 ARP 요청 메세지의 목표 MAC 주소는 모르기에 더미 MAC 주소인 `00:00:00:00:00:00`로 채운다.  
* ### ARP Reply
* * ARP 요청 패킷에 포함된 IP 주소와 일치하는 호스트는 자신의 IP 주소 및 MAC 주소를 채워놓은 ARP 응답 패킷을 해당 라우터에게 전송한다. `유니캐스트`
* * 물리 주소 및 IP 주소 상호간의 관련 정보를 얻게 된다.


## ARP 캐시
상대방의 MAC 주소를 보낼때 브로드캐스트를 사용하게 되는데 여러 단말이 있는 네트워크에서 모두가 ARP를 송신하면 그 네트워크에는 ARP 트래픽만 가득 할 것이다. 
IP 주소가 MAC 주소와는 달리 고정적이지는 않지만 자주 변하는 것은 아니다. 때문에 ARP는 주소 결정한 내용을 일정 기간 동안 저장하는 캐시 기능을 제공한다.  
ARP에서 MAC 주소를 알았다면 ARP 테이블의 엔트리로 추가하고 저장한다. 엔트리를 저장하고 있는 동안 ARP를 송신하지 않는다. 그리고 일정 시간(타임 아웃 시간)이 경과하면
엔트리를 삭제하고 다시 ARP 요청을 송신한다. 



# RARP
ARP가 IP 주소를 갖고 MAC를 찾는 프로토콜이었다면, MAC주소를 갖고 IP 주소를 찾는 프로토콜은 RARP 이다. 
